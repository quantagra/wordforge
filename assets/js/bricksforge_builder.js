class BricksforgeBuilder{bricksPanelObserver=null;bricksStructureObserver=null;bricksRoot=null;bricksState=null;bricksContent=null;bricksActiveElement=null;bricksActiveElementObject=null;bricksforgeRoot=null;bricksforgeState=null;bricksforgeStores=null;bricksforgeStoreAi=null;constructor(){this.init()}init(){this.createVueWrapper(),this.initVueInstances(),this.initMutationObservers()}createVueWrapper(){const e=document.createElement("div");e.id="bricksforge-builder";document.querySelector("#bricks-preview")&&document.querySelector("#bricks-preview").appendChild(e)}initVueInstances(){this.bricksRoot=document.querySelector(".brx-body").__vue_app__.config.globalProperties,this.bricksState=this.bricksRoot.$_state,this.bricksContent=this.bricksState.content,setTimeout((()=>{this.bricksforgeRoot=document.querySelector("#bricksforge-builder").__vue_app__.config.globalProperties,this.bricksforgeState=this.bricksforgeRoot.$pinia.state,this.bricksforgeStores=this.bricksforgeState._value,this.bricksforgeStoreAi=this.bricksforgeStores.ai}),1500)}refreshState(){this.bricksState=this.bricksRoot.$_state,this.bricksContent=this.bricksState.content}initMutationObservers(){this.bricksPanelObserver=new MutationObserver((e=>{if(this.getActiveElement(),"brf-pro-forms"===this.bricksActiveElement)this.handleProForms()})),this.bricksPanelObserver.observe(document.querySelector("#bricks-panel-inner"),{childList:!0,subtree:!0}),this.bricksStructureObserver=new MutationObserver((e=>{this.handleProFormsDuplicatedIds()})),this.bricksStructureObserver.observe(document.querySelector("#bricks-structure"),{childList:!0,subtree:!0})}getActiveElement(e=!1){return this.bricksState.activeElement?e?(this.bricksActiveElementObject=this.bricksState.activeElement,this.bricksState.activeElement):(this.bricksActiveElement=this.bricksState.activeElement.name,this.bricksState.activeElement.name):null}handleProForms(){}handleProFormsAi(){const e=document.querySelector(".bricks-panel-controls");if(e&&!e.querySelector(".bricksforge-button-ai")){const t=this.createButton("Bricksforge Assistant","block",{marginBottom:"-10px"},null,(()=>{this.bricksforgeStoreAi.showAiModal=!0}));e.prepend(t)}}handleProFormsDuplicatedIds(){this.refreshState();const e=this.bricksContent.filter((e=>e.name.includes("brf-pro-forms-field")));if(!e)return;const t=e.map((e=>e.settings.id)).filter(((e,t,r)=>r.indexOf(e)!==t));t&&t.forEach((t=>{const r=e.filter((e=>e.settings.id===t));if(r.length>1){const e=r[r.length-1];this.updateElementSetting(e.id,"id",this.bricksRoot.$_generateId())}}))}generateRandomId(){return Math.random().toString(36).substr(2,9)}createButton(e,t="block",r={},i={},s=null){const n=document.createElement("button"),c=document.createElement("div");if("block"===t)c.classList.add("bricksforge-button-wrapper"),n.classList.add("button"),n.classList.add("block"),n.classList.add("bricksforge-button"),n.classList.add("bricksforge-button-ai");if(n.innerText=e,r)for(const[e,t]of Object.entries(r))n.style[e]=t;if(i)for(const[e,t]of Object.entries(i))n.setAttribute(e,t);return s&&n.addEventListener("click",s),c.appendChild(n),c}updateElementSetting(e,t,r){this.refreshState();const i=this.bricksContent.find((t=>t.id===e));i&&i.settings&&(i.settings[t]=r)}}document.addEventListener("DOMContentLoaded",(()=>{!bricksIsFrontend&&document.querySelector("#bricks-toolbar")&&setTimeout((()=>{new BricksforgeBuilder}),1e3)}));